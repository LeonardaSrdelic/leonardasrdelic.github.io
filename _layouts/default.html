<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "hr" }}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="{{ page.description | default: site.description }}">
    <title>{{ page.title | default: site.title }}</title>
    <link rel="canonical" href="{{ page.url | relative_url }}">

    <!-- Including Font Awesome via CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    {%- include head.html -%}
  </head>
  <body>

    {%- include header.html -%}
    <main class="page-content">
      <div class="wrapper">
        <!-- Page content -->
        {{ content }}
      </div>
    </main>
    {%- include footer.html -%}
    <div id="cookie-banner" class="cookie-banner" style="display: none;">
      <p>Ova stranica koristi kolačiće za analizu prometa. <a href="{{ '/policy.html' | relative_url }}">Saznaj više</a>.</p>
      <div class="cookie-buttons">
        <button id="btn-accept" class="btn-cookie-accept">Prihvaćam</button>
        <button id="btn-reject" class="btn-cookie-reject">Odbijam</button>
      </div>
    </div>
    <script src="{{ '/assets/navigation.js' | relative_url }}" defer></script>
    <script>
      // Google Consent Mode v2 setup
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }

      var GA_ID = 'G-MNWHH06E2E';
      var consent = localStorage.getItem('cookieConsent');

      // Default: deny everything unless previously granted
      gtag('consent', 'default', {
        ad_storage: consent || 'denied',
        ad_user_data: consent || 'denied',
        ad_personalization: consent || 'denied',
        analytics_storage: consent || 'denied'
      });

      function loadGoogleAnalytics() {
        if (window.__gaLoaded) return;
        var gaScript = document.createElement('script');
        gaScript.async = true;
        gaScript.src = 'https://www.googletagmanager.com/gtag/js?id=' + GA_ID;
        document.head.appendChild(gaScript);
        gtag('js', new Date());
        gtag('config', GA_ID);
        window.__gaLoaded = true;
      }

      document.addEventListener('DOMContentLoaded', function() {
        var banner = document.getElementById('cookie-banner');
        var acceptBtn = document.getElementById('btn-accept');
        var rejectBtn = document.getElementById('btn-reject');

        if (!consent && banner) {
          banner.style.display = 'flex';
        } else if (consent === 'granted') {
          loadGoogleAnalytics();
        }

        if (acceptBtn) {
          acceptBtn.addEventListener('click', function() {
            localStorage.setItem('cookieConsent', 'granted');
            gtag('consent', 'update', {
              ad_storage: 'granted',
              ad_user_data: 'granted',
              ad_personalization: 'granted',
              analytics_storage: 'granted'
            });
            loadGoogleAnalytics();
            if (banner) banner.style.display = 'none';
          });
        }

        if (rejectBtn) {
          rejectBtn.addEventListener('click', function() {
            localStorage.setItem('cookieConsent', 'denied');
            gtag('consent', 'update', {
              ad_storage: 'denied',
              ad_user_data: 'denied',
              ad_personalization: 'denied',
              analytics_storage: 'denied'
            });
            if (banner) banner.style.display = 'none';
          });
        }
      });
    </script>
  </body>
</html>
